<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta name="msvalidate.01" content="EA008985D70B41C498FF534F5BF2DF53" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Minecraft 像素画转换器 | HelloWorld</title>
  <meta name="description" content="一个用来快速将图片转换为我的世界像素画的工具">
<meta property="og:type" content="website">
<meta property="og:title" content="Minecraft 像素画转换器">
<meta property="og:url" content="https://helloworldztr.github.io/mc/index.html">
<meta property="og:site_name" content="HelloWorld">
<meta property="og:description" content="一个用来快速将图片转换为我的世界像素画的工具">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-05-23T03:03:49.000Z">
<meta property="article:modified_time" content="2020-05-29T13:44:40.825Z">
<meta property="article:author" content="HelloWorldZTR">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="https://helloworldztr.github.io/mc/index.html">
  
    <link rel="alternate" href="/atom.xml" title="HelloWorld" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.css">
  
<meta name="generator" content="Hexo 4.2.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://helloworldztr.github.io">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">HelloWorldZTR</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Developer &amp; PC Enthusiast</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shandong, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tools">
          <a href="/tools">
            
            <i class="icon icon-book-shelf"></i>
            
            <span class="menu-title">Tools</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/HelloWorldZTR" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>Welcome to my site!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Develop/">Develop</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hackintosh/">Hackintosh</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Website/" rel="tag">Website</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Website/" style="font-size: 14px;">Website</a> <a href="/tags/java/" style="font-size: 14px;">java</a> <a href="/tags/springboot/" style="font-size: 13px;">springboot</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Develop/">Develop</a>
              </p>
              <p class="item-title">
                <a href="/2020/05/23/Pixel-gen-user-guide/" class="title">我的世界像素生成器使用指南</a>
              </p>
              <p class="item-date">
                <time datetime="2020-05-23T06:53:04.000Z" itemprop="datePublished">2020-05-23</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Other/">Other</a>
              </p>
              <p class="item-title">
                <a href="/2020/05/17/Create-pdf-in-macOS/" class="title">macOS 小妙招—快速创建 pdf</a>
              </p>
              <p class="item-date">
                <time datetime="2020-05-17T07:59:54.000Z" itemprop="datePublished">2020-05-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Develop/">Develop</a>
              </p>
              <p class="item-title">
                <a href="/2020/05/17/Image-hosting-tips/" class="title">个人博客搭建—使用图床</a>
              </p>
              <p class="item-date">
                <time datetime="2020-05-17T04:00:00.000Z" itemprop="datePublished">2020-05-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Develop/">Develop</a>
              </p>
              <p class="item-title">
                <a href="/2020/04/09/Gitalk-register-and-use/" class="title">个人博客搭建—使用 Gitalk</a>
              </p>
              <p class="item-date">
                <time datetime="2020-04-08T23:16:44.000Z" itemprop="datePublished">2020-04-09</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Develop/">Develop</a>
              </p>
              <p class="item-title">
                <a href="/2020/04/08/WebSite-Build-instruction/" class="title">个人博客搭建指南</a>
              </p>
              <p class="item-date">
                <time datetime="2020-04-08T08:29:02.000Z" itemprop="datePublished">2020-04-08</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="page-" class="article article-type-page" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Minecraft 像素画转换器
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/mc/index.html" class="article-date">
	  <time datetime="2020-05-23T03:03:49.000Z" itemprop="datePublished">2020-05-23</time>
	</a>
</span>
        
        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/mc/index.html#comments" class="article-comment-link">Comments</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">Total: 1.1k(words)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Time: 6(minutes)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>一个用来快速将图片转换为我的世界像素画的工具</p>
<a id="more"></a>
<link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>
<!--图片上传css-->
<style>
    .container {
        margin-top: 20px;
    }


<pre><code>.image-preview-input {
    position: relative;
    overflow: hidden;
    margin: 0px;
    color: #333;
    background-color: #fff;
    border-color: #ccc;
}

.image-preview-input input[type=file] {
    position: absolute;
    top: 0;
    right: 0;
    margin: 0;
    padding: 0;
    font-size: 20px;
    cursor: pointer;
    opacity: 0;
    filter: alpha(opacity=0);
}

.image-preview-input-title {
    margin-left: 2px;
}

div #result {
    overflow-x: scroll;
    white-space: nowrap;
    line-height: 16px;
    scale: 0.5;
}

canvas {
    width: 100%;
    image-rendering: pixelated;
}

.hw {
    width: -webkit-fill-available;
}</code></pre><p></style></p>
<!--js核心代码-->
<script>
    /**
    * [thresholdConvert 阈值处理]
    * @param  {[type]} ctx       [description]
    * @param  {[type]} imageData [description]
    * @param  {[type]} threshold [阈值]
    * @param  {[type]} mode      [模式：0：彩色，1：黑白]
    * @return {[type]}           [description]
    */
    function thresholdConvert(ctx, imageData, threshold, mode) {
        var data = imageData.data;
        for (var i = 0; i < data.length; i += 4) {
            var red = data[i];
            var green = data[i + 1];
            var blue = data[i + 2];
            var alpha = data[i + 3];
            // 灰度计算公式
            var gray = 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];
            var color = gray >= threshold ? 255 : 0;
            data[i] = (mode == 0 && color == 0) ? red : color;    // red
            data[i + 1] = (mode == 0 && color == 0) ? green : color;  // green
            data[i + 2] = (mode == 0 && color == 0) ? blue : color;   // blue
            data[i + 3] = alpha >= threshold ? 255 : 0;               // 去掉透明
        }
        ctx.putImageData(imageData, 0, 0);
    };
    // 魔法®
    function getPixel(imgData, index) {
        var i = index * 4, d = imgData.data;
        return [d[i], d[i + 1], d[i + 2], d[i + 3]] // [R,G,B,A]
    }
    function getPixelXY(imgData, x, y) {
        return getPixel(imgData, y * imgData.width + x);
    }
    function Block(name, id, src, rgb) {
        this.name = name;
        this.id = id;
        this.src = src;
        this.rgb = rgb;
        // this.getName = function () { return this.name; }
        // this.getId = function () { return this.id; }
        // this.getSrc = function () { return this.src; }
        // this.getRGB = function () { return this.rgb; }
        // this.getImage = function () {
        //     return new Image().src = this.src;
        // }
    }
    $(document).on('click', '#close-preview', function () {
        $('.image-preview').popover('hide');
        // Hover befor close the preview
        $('.image-preview').hover(
            function () {
                $('.image-preview').popover('show');
            },
            function () {
                $('.image-preview').popover('hide');
            }
        );
    });
    var width;  //现在的宽度
    var height; //现在的高度
    var cvs;    //预览canvas
    var ctx;    //cvs的content
    var idt;    //content的imagedata
    var img;    //原始Image
    //方块字典
    var blocks = new Array(
        new Block('黑色羊毛', 0, 'https://i.loli.net/2020/05/23/LfWvgJ4QB6jixDX.png', new Array(20, 21, 25)),
        new Block('蓝色羊毛', 1, 'https://i.loli.net/2020/05/23/vKYTm3zPfOLZS6M.png', new Array(53, 57, 157)),
        new Block('棕色羊毛', 2, 'https://i.loli.net/2020/05/23/Zt8b2ikBEFHlarV.png', new Array(113, 71, 40)),
        new Block('青色羊毛', 3, 'https://i.loli.net/2020/05/23/Y8qQbOtZIe5Rp2l.png', new Array(21, 136, 144)),
        new Block('灰色羊毛', 4, 'https://i.loli.net/2020/05/23/Md9TVqx3ybUgEKf.png', new Array(63, 68, 71)),
        new Block('绿色羊毛', 5, 'https://i.loli.net/2020/05/23/OYzkALha98VdgSW.png', new Array(84, 109, 27)),
        new Block('淡蓝色羊毛', 6, 'https://i.loli.net/2020/05/23/WnIYFBsGj138xai.png', new Array(58, 175, 218)),
        new Block('淡灰色羊毛', 7, 'https://i.loli.net/2020/05/23/715JZIlmOd6boNM.png', new Array(142, 143, 135)),
        new Block('黄绿色羊毛', 8, 'https://i.loli.net/2020/05/23/uGvEfnO3KBSsgHT.png', new Array(111, 184, 25)),
        new Block('洋红色羊毛', 9, 'https://i.loli.net/2020/05/23/dNPcp2SWwAUQH1R.png', new Array(190, 69, 180)),
        new Block('橙色羊毛', 10, 'https://i.loli.net/2020/05/23/L7P2aZ9hkj4Qcox.png', new Array(241, 119, 20)),
        new Block('粉色羊毛', 11, 'https://i.loli.net/2020/05/23/qDiNEI1Jhv6YBgC.png', new Array(238, 141, 171)),
        new Block('紫色羊毛', 12, 'https://i.loli.net/2020/05/23/4L5MKaTnBRFYywf.png', new Array(119, 40, 170)),
        new Block('红色羊毛', 13, 'https://i.loli.net/2020/05/23/lwVCI5R8ZPHzqxt.png', new Array(160, 39, 34)),
        new Block('白色羊毛', 14, 'https://i.loli.net/2020/05/23/4dr5iqu36aZGbsy.png', new Array(255, 255, 255)),
        new Block('黄色羊毛', 15, 'https://i.loli.net/2020/05/23/alwkYHR4z2oLWuJ.png', new Array(248, 196, 39))
    )
    var blocks2 = new Array(
        new Block('黑色羊毛', 0, 'https://i.loli.net/2020/05/23/LfWvgJ4QB6jixDX.png', new Array(20, 21, 25)),
        new Block('蓝色羊毛', 1, 'https://i.loli.net/2020/05/23/vKYTm3zPfOLZS6M.png', new Array(53, 57, 157)),
        new Block('棕色羊毛', 2, 'https://i.loli.net/2020/05/23/Zt8b2ikBEFHlarV.png', new Array(113, 71, 40)),
        new Block('青色羊毛', 3, 'https://i.loli.net/2020/05/23/Y8qQbOtZIe5Rp2l.png', new Array(21, 136, 144)),
        new Block('灰色羊毛', 4, 'https://i.loli.net/2020/05/23/Md9TVqx3ybUgEKf.png', new Array(63, 68, 71)),
        new Block('绿色羊毛', 5, 'https://i.loli.net/2020/05/23/OYzkALha98VdgSW.png', new Array(84, 109, 27)),
        new Block('淡蓝色羊毛', 6, 'https://i.loli.net/2020/05/23/WnIYFBsGj138xai.png', new Array(58, 175, 218)),
        new Block('淡灰色羊毛', 7, 'https://i.loli.net/2020/05/23/715JZIlmOd6boNM.png', new Array(142, 143, 135)),
        new Block('黄绿色羊毛', 8, 'https://i.loli.net/2020/05/23/uGvEfnO3KBSsgHT.png', new Array(111, 184, 25)),
        new Block('洋红色羊毛', 9, 'https://i.loli.net/2020/05/23/dNPcp2SWwAUQH1R.png', new Array(190, 69, 180)),
        new Block('橙色羊毛', 10, 'https://i.loli.net/2020/05/23/L7P2aZ9hkj4Qcox.png', new Array(241, 119, 20)),
        new Block('粉色羊毛', 11, 'https://i.loli.net/2020/05/23/qDiNEI1Jhv6YBgC.png', new Array(238, 141, 171)),
        new Block('紫色羊毛', 12, 'https://i.loli.net/2020/05/23/4L5MKaTnBRFYywf.png', new Array(119, 40, 170)),
        new Block('红色羊毛', 13, 'https://i.loli.net/2020/05/23/lwVCI5R8ZPHzqxt.png', new Array(160, 39, 34)),
        new Block('白色羊毛', 14, 'https://i.loli.net/2020/05/23/4dr5iqu36aZGbsy.png', new Array(255, 255, 255)),
        new Block('黄色羊毛', 15, 'https://i.loli.net/2020/05/23/alwkYHR4z2oLWuJ.png', new Array(248, 196, 39)),
        //TODO:: ADD more blocks
        new Block('黄绿色染色玻璃', 16, 'https://i.loli.net/2020/05/24/pnlw4P6ECS8YsR7.png', new Array(127, 204, 25))
    )
    $(function () {
        //添加所有方块
        // $('#allTable')
        var woolTable = document.getElementById('woolTable');
        for (var i=0; i<blocks.length; i++) {
            var item = blocks[i];
            var row = document.createElement('tr');
            var cell0 = document.createElement('td');
            cell0.innerHTML = '<input class="selector1" type="checkbox">';
            var cell1 = document.createElement('td');
            cell1.innerHTML = item.id;
            var cell2 = document.createElement('td');
            cell2.innerHTML = item.name;
            var cell3 = document.createElement('td');
            var image = new Image();image.src = item.src;
            cell3.appendChild(image);
            row.appendChild(cell0);
            row.appendChild(cell1);
            row.appendChild(cell2);
            row.appendChild(cell3);
            woolTable.appendChild(row);
        }
        $('#woolModalAll').change(function() {
            if($('#woolModalAll').prop('checked')) {
                $('.selector1').prop('checked',true)
            }
            else {
                $('.selector1').removeProp('checked');
            }
        });
        var alltable = document.getElementById('allTable');
        for (var i=0; i<blocks2.length; i++) {
            var item = blocks2[i];
            var row = document.createElement('tr');
            var cell0 = document.createElement('td');
            cell0.innerHTML = '<input class="selector2" type="checkbox" value="'+item.id+'" checked>';
            var cell1 = document.createElement('td');
            cell1.innerHTML = item.id;
            var cell2 = document.createElement('td');
            cell2.innerHTML = item.name;
            var cell3 = document.createElement('td');
            var image = new Image();image.src = item.src;
            cell3.appendChild(image);
            row.appendChild(cell0);
            row.appendChild(cell1);
            row.appendChild(cell2);
            row.appendChild(cell3);
            allTable.appendChild(row);
        }
        var selector2 = document.getElementsByClassName('selector2');
        $('#allModalAll').change(function(){
            console.log($('#allModalAll').prop('checked'))
            if($('#allModalAll').prop('checked')) {
                $('.selector2').prop('checked',true)
            }
            else {
                $('.selector2').removeProp('checked');
            }
        });
        // Clear event
        $('.image-preview-clear').click(function () {
            $('.image-preview').attr("data-content", "").popover('hide');
            $('.image-preview-filename').val("");
            $('.image-preview-clear').hide();
            $('.image-preview-input input:file').val("");
            $(".image-preview-input-title").text("Browse");
        });
        // Create the preview image
        $(".image-preview-input input:file").change(function () {
            img = $('img#preview')[0];
            var file = this.files[0];
            var reader = new FileReader();
            // Set preview image into the popover data-content
            reader.onload = function (e) {
                $(".image-preview-input-title").text("Change");
                $(".image-preview-clear").show();
                $(".image-preview-filename").val(file.name);
                // img.attr('src', e.target.result);
                img.src = e.target.result;
                // $(".image-preview").attr("data-content", $(img)[0].outerHTML).popover("show");
            }
            reader.readAsDataURL(file);
            img.onload = function (e) {
                if (cvs != null)
                    document.getElementById("DEBUG").removeChild(cvs)
                width = img.width;
                height = img.height;

                cvs = document.createElement('canvas');
                cvs.height = height;
                cvs.width = width;
                ctx = cvs.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                idt = ctx.getImageData(0, 0, width, height);
                // var pixek = getPixel(idt, 852);
                // var pixel = getPixelXY(idt, 1, 1);
                // console.log(pixel);
                //Init paramiters
                document.getElementById('width').value = width;
                document.getElementById('height').value = height;
                $('#DEBUG').append(cvs);
                // TODO::PROCCESS IMAGE
                // doImage();
                changeThs();
            }
        });
    });
    function getCostomBlockInfo() {
        customBlocks1.length=0;
        customBlocks2.length=0;
        var wools = $('#woolTable');
        // console.log(wools.find('tr'));
        wools.find('tr').each(function() {
            var children = this.children;
            var checkedbox = children[0];
            var id = Number(children[1].innerText);
            if(checkedbox.children[0].checked) {
                customBlocks1.push(blocks[id]);
            }
        })
        var alls = $('#allTable');
        alls.find('tr').each(function() {
            var children = this.children;
            var checkedbox = children[0];
            var id = Number(children[1].innerText);
            if(checkedbox.children[0].checked) {
                customBlocks2.push(blocks2[id]);
            }
        })
    }
    var customBlocks1 = new Array();
    var customBlocks2 = new Array();
    function doImage() {
        console.log("开始处理图像");
        var img = $('img#preview')[0];
        var width = Number(document.getElementById('width').value);
        var height = Number(document.getElementById('height').value);
        var material;
        if (document.getElementById('Block').checked) {
            material = 0;
        }
        else {
            material = 1;
        }
        console.log(width);
        console.log(height);
        console.log(material);
        if (width == 0 || height == 0) {
            window.alert("不合法的宽高")
        }
        else if (material > 1 || material < 0) {
            window.alert("不合法的类型")
        }
        // cvs = document.createElement('canvas');
        // cvs.height = height;
        // cvs.width = width;
        // ctx = cvs.getContext('2d');
        // ctx.drawImage(img, 0, 0, width, height);
        // idt = ctx.getImageData(0, 0, width, height);
        // TODO::delete this
        $('#DEBUG').append(cvs);
        var result = document.createElement('div');
        result.id = 'result';
        document.getElementById('result-box').appendChild(result);
        $('#pg').attr("style", 'width: 0%');
        getCostomBlockInfo();
        var worker = new Worker("/js/worker.js");
        if (material == 0) {//羊毛
            var msg = {
                h: height,
                w: width,
                blc: customBlocks1,
                idt: idt
            };
            worker.postMessage(msg);
        }
        else {//全物品
            var msg = {
                h: height,
                w: width,
                blc: customBlocks2,
                idt: idt
            };
            worker.postMessage(msg);
        }
        worker.onmessage = function (message) {
            var data = message.data;
            console.log(data);
            if (data.terminate) {
                var row = data.row;
                for (var x = 0; x < row.length; x++) {
                    var col = row[x];
                    for (var y = 0; y < col.length; y++) {
                        var cell = new Image();
                        if($('#Block').prop('checked'))
                            cell.src = blocks[col[y]].src;
                        else    
                            cell.src = blocks2[col[y]].src;
                        document.getElementById('result').append(cell);
                    }
                    document.getElementById('result').appendChild(document.createElement('br'));
                }
                var bp = data.bp;
                document.getElementById('blueprint').innerHTML = bp;
                document.getElementById('list').style = "";
                for (var i = 0; i < data.list.length; i++) {
                    if (data.list[i] != null) {
                        var row = document.createElement('tr');
                        var name = blocks[i].name;
                        var cnt = data.list[i];
                        var cell0 = document.createElement('td');
                        var img = new Image();
                        img.src = blocks[i].src;
                        cell0.appendChild(img);
                        var cell1 = document.createElement('td');
                        cell1.innerHTML = name;
                        var cell2 = document.createElement('td');
                        cell2.innerHTML = cnt;
                        row.appendChild(cell0);
                        row.appendChild(cell1);
                        row.appendChild(cell2);
                        document.getElementById('list-inner').appendChild(row);
                    }
                }
                $("#pgModal").modal("hide");
                worker.terminate();
            }
            else {
                var data = message.data;
                var per = data.per;
                $('#pg').attr("style", 'width:' + per + '%');
            }
        }
        worker.onerror = function (error) {
            console.log(error.filename, error.lineno, error.message);
        }
        // var list = new Array();
        // if (material == 0) {
        //     var bp = "顺序：自下而上，自左至右\n"
        //     for (var y = 0; y < height; y++) {
        //         // if(y%16==0) {
        //         //     var percent = y / height;
        //         //     $('#pg').attr("aria-valuenow", percent);
        //         //     $('#pg').attr("style", 'width:'+percent*100+'%');
        //         //     console.log(percent);
        //         //     $("#text").text(percent);
        //         // }
        //         var info = "第" + (height - y) + "行: ";
        //         var row = document.createElement('br');
        //         var cnt = 0;
        //         var last;
        //         for (var x = 0; x < width; x++) {
        //             var pixel = getPixelXY(idt, x, y);
        //             var cell = new Image();
        //             var diff = 10000000000;
        //             var best = 0;
        //             for (var i = 0; i < blocks.length; i++) {
        //                 var tempRGB = blocks[i].getRGB();
        //                 var tempDiff = Math.abs(tempRGB[0] - pixel[0]) + Math.abs(tempRGB[1] - pixel[1]) + Math.abs(tempRGB[2] - pixel[2]);
        //                 if (tempDiff < diff) {
        //                     diff = tempDiff;
        //                     best = i;
        //                 }
        //             }
        //             cell.src = blocks[best].getSrc();
        //             document.getElementById('result').appendChild(cell);
        //             list[best] = list[best] == null ? 0 : list[best] + 1;
        //             if (last == null) {
        //                 cnt++;
        //                 last = best;
        //             }
        //             else {
        //                 if (last == best) {
        //                     cnt++;
        //                 }
        //                 else {//best != last
        //                     info += cnt + "*" + blocks[last].getName() + " ";
        //                     cnt = 1;
        //                     last = best;
        //                 }
        //                 if (x == width - 1) {
        //                     info += cnt + "*" + blocks[last].getName() + " ";
        //                 }
        //             }
        //         }
        //         // console.log(info);
        //         bp += info + "\n";
        //         document.getElementById('result').appendChild(row);
        //     }
        //     document.getElementById('blueprint').innerHTML = bp;
        //     $('#pgModal').modal("hide");
        // }
        // else {
        // }
    }
    //重置所有设置
    function doReset() {
        // document.getElementById('width').value = width == null ? 0 : width;
        // document.getElementById('height').value = height == null ? 0 : height;
        var origin_width = img.width;
        var origin_height = img.height
        $('#width').attr('value', origin_width).val(origin_width);
        $('#height').attr('value', origin_height).val(origin_height);
        $('#Block').attr('checked', true);
        $('#ths').attr('value', 200).val(200);
        width = origin_width;
        height = origin_height;
        ctx.drawImage(img, 0, 0, width, height);
        idt = ctx.getImageData(0, 0, width, height);
        changeThs();
    }
    function adjustHeight() {
        if (document.getElementById('lock_ratio').checked) {
            var tempWidth = Number(document.getElementById('width').value);
            // var ratio = Math.floor(tempWidth / width);
            // console.log("Ratio="+ratio)
            var tempHeight = Math.floor(height * tempWidth / width);
            tempWidth = Math.floor(width * tempHeight / height);
            console.log('h=' + tempHeight);
            console.log('w=' + tempWidth);
            document.getElementById('width').value = tempWidth;
            document.getElementById('height').value = tempHeight;
            height = tempHeight;
            width = tempWidth;
            changeThs();
        }
    }
    function adjustWidth() {
        if (document.getElementById('lock_ratio').checked) {
            var tempHeight = Number(document.getElementById('height').value);
            // var ratio = Math.floor(tempHeight / height);
            // console.log("Ratio="+ratio)
            var tempWidth = Math.floor(width * tempHeight / height);
            tempHeight = Math.floor(height * tempWidth / width);
            console.log('h=' + tempHeight);
            console.log('w=' + tempWidth);
            document.getElementById('width').value = tempWidth;
            document.getElementById('height').value = tempHeight;
            height = tempHeight;
            width = tempWidth;
            changeThs();
        }
    }
    function test() {
        getCostomBlockInfo();
        console.log(customBlocks1);
        console.log(customBlocks2);
    }
    function changeThs() {
        document.getElementById('DEBUG').removeChild(cvs);
        cvs = document.createElement('canvas');
        cvs.height = height;
        cvs.width = width;
        ctx = cvs.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);
        idt = ctx.getImageData(0, 0, width, height);
        var blackwhite = $('#blackwhite').attr('checked') == true ? 1 : 0;
        var ths = Number(document.getElementById('ths').value);
        thresholdConvert(ctx, idt, ths, blackwhite);
        // console.log(ths,blackwhite)
        document.getElementById('thsv').innerHTML = ths;
        document.getElementById('DEBUG').appendChild(cvs);
    }
    //打开自定义窗口
    function openCustom() {
        var isWool = document.getElementById('Block').checked;
        //  console.log(isWool);
        if (isWool) {
            $('#woolModal').modal('show');
        }
        else {
            $('#allModal').modal('show');
        }
    }
</script>
<div class="row clearfix">
    <!--左栏-->
    <div class="col-xs-12 col-md-8 col-sm-12 ">
        <h2>请选择图片</h2>
        <div class="input-group image-preview">
            <input type="text" class="form-control image-preview-filename" disabled="disabled">
            <span class="input-group-btn">
                <!-- image-preview-clear button -->
                <button type="button" class="btn btn-default image-preview-clear" style="display:none;">
                    <span class="glyphicon glyphicon-remove"></span> Clear
                </button>
                <!-- image-preview-input -->
                <div class="btn btn-default image-preview-input">
                    <span class="glyphicon glyphicon-folder-open"></span>
                    <span class="image-preview-input-title">Browse</span>
                    <input type="file" accept="image/png, image/jpeg, image/gif" name="input-file-preview" />
                </div>
            </span>
        </div>
        <div id="DEBUG">
            <img id="preview" style="display: none;" />
        </div>
    </div>
    <!--右栏-->
    <div class="col-xs-12 col-md-12 col-sm-12 col-lg-4">
        <h2>设置</h2>
        <!-- <form role="form"> -->
        <div class="row clearfix">
            <!--左-->
            <div class="form-group col-xs-6 col-sm-6 col-lg-12">
                <h3>图片大小</h3>
                <label>
                    <input id="lock_ratio" type="checkbox" checked>&nbsp;锁定宽高比
                </label><br>
                <label>
                    宽&nbsp;<input class="hw" id="width" type="number" value="0" onchange="adjustHeight()"> 方块
                </label>
                <label>
                    高&nbsp;<input class="hw" id="height" type="number" value="0" onchange="adjustWidth()"> 方块
                </label>
                <h3>材料</h3>
                <label>
                    <input id="Block" name="material" type="radio" value="0" checked> 羊毛/混凝土&nbsp;
                    <input id="conc" name="material" type="radio" value="1"> 全物品
                </label>
                <button class="btn-default btn" onclick="openCustom();">自定义</button>
            </div>
            <div class="col-xs-6 col-sm-6 col-lg-12">
                <h3>抗锯齿</h3>
                <label>
                    <p>此功能开发中</p>
                    <input id="1x" name="anti" type="radio" value="0" checked> 无&nbsp;
                    <input id="2x" name="anti" type="radio" disabled="true">2x&nbsp;
                    <input id="4x" name="anti" type="radio" disabled="true">4x&nbsp;
                    <input id="8x" name="anti" type="radio" disabled="true">8x&nbsp;
                </label>
                <h3>阈值</h3>
                <label>
                    <input type="range" name="slider-1" id="ths" min="0" max="255" step="1" value="200"
                        onchange="changeThs()">
                    <p id="thsv"></p>
                    <input id="blackwhite" type="checkbox">&nbsp;黑白模式
                </label>
            </div>
            <!--右-->
        </div>
        <h3></h3>
        <button id="btn_ok" class="btn btn-primary" onclick="$('#pgModal').modal('show');">确定</button>
        &nbsp;
        <button id="btn_can" class="btn btn-default" onclick="doReset()">重置</button>
        &nbsp;
            <button id="btn_test" class="btn btn-default" onclick="test()">Test</button>
        &nbsp;
        <button class="btn btn-default" data-toggle="modal" data-target="#myModal">蓝图</button>
        <!-- </form> -->
    </div>
</div>
<div id="result-box" class="row">
    <!-- <div id="result" class="col-8">
    </div> -->
</div>
<div id="list" class="row" style="display: none;">
    <div class="col-md-6">
        <h2>物料清单</h2>
        <table class="table">
            <tbody id="list-inner">
            </tbody>
        </table>
    </div>
</div>

<!-- 模态框（Modal） -->
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">蓝图</h4>
            </div>
            <div class="modal-body">
                <textarea id="blueprint" rows="50" style="width: 100%;"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <!-- <button type="button" class="btn btn-primary">提交更改</button> -->
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<!-- 模态框（Modal） -->
<div id="pgModal" class="modal fade" tabindex="-2" role="dialog" aria-labelledby="pgModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">进度</h4>
            </div>
            <div class="modal-body">
                <p>进行大量运算可能导致浏览器假死，请耐心等待！！</p>
                <div class="progress">
                    <p id="text"></p>
                    <div id="pg" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"
                        aria-valuemax="1">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="doImage();">开始</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<!-- 模态框（Modal） -->
<div id="woolModal" class="modal fade" tabindex="-3" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">自定义...</h4>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <label>
                        全选&nbsp;
                        <input type="checkbox" id="woolModalAll" name="woolSelector">
                        &nbsp;羊毛&nbsp;
                        <input type="checkbox" id="woolModalWool" name="woolSelector">
                        &nbsp;混凝土&nbsp;
                        <input type="checkbox" id="woolModalConc" name="woolSelector">
                    </label>
                    &nbsp;&nbsp;
                    <table class="table">
                        <thead>
                            <tr>
                                <td>选择</td>
                                <td>ID</td>
                                <td>名称</td>
                                <td>图片</td>
                            </tr>
                        </thead>
                        <tbody id="woolTable">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<!-- 模态框（Modal） -->
<div id="allModal" class="modal fade" tabindex="-4" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">自定义...</h4>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <label>
                        全选&nbsp;
                        <input type="checkbox" id="allModalAll" name="woolSelector" checked>
                        &nbsp;羊毛&nbsp;
                        <input type="checkbox" id="allModalWool" name="woolSelector">
                        &nbsp;混凝土&nbsp;
                        <input type="checkbox" id="allModalConc" name="woolSelector">
                        &nbsp;土豪矿物系列&nbsp;
                    </label>
                    &nbsp;&nbsp;
                    <table class="table">
                        <thead>
                            <tr>
                                <td>选择</td>
                                <td>ID</td>
                                <td>名称</td>
                                <td>图片</td>
                            </tr>
                        </thead>
                        <tbody id="allTable">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>

<h4 id="使用前必读：-https-helloworldztr-github-io-2020-05-23-Pixel-gen-user-guide"><a href="#使用前必读：-https-helloworldztr-github-io-2020-05-23-Pixel-gen-user-guide" class="headerlink" title="使用前必读： https://helloworldztr.github.io/2020/05/23/Pixel-gen-user-guide/"></a>使用前必读： <a href="https://helloworldztr.github.io/2020/05/23/Pixel-gen-user-guide/">https://helloworldztr.github.io/2020/05/23/Pixel-gen-user-guide/</a></h4><h4 id="作者：HelloWorldZTR"><a href="#作者：HelloWorldZTR" class="headerlink" title="作者：HelloWorldZTR"></a>作者：HelloWorldZTR</h4>
      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>Link Addr：</strong>
      <a href="https://helloworldztr.github.io/mc/index.html" title="Minecraft 像素画转换器" target="_blank" rel="external">https://helloworldztr.github.io/mc/index.html</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>Copyright： </strong> All articles of this blog use <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0</a> license. Include the link above if you want to copy it！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://helloworldztr.github.io" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://helloworldztr.github.io" target="_blank"><span class="text-dark">HelloWorldZTR</span><small class="ml-1x">Developer &amp; PC Enthusiast</small></a></h3>
        <div>A programmer of some sort. Loves coding and all kinds of things about computers.</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/HelloWorldZTR" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>












</body>
</html>